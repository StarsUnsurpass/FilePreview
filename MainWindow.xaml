<ui:FluentWindow x:Class="FilePreview.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        xmlns:local="clr-namespace:FilePreview"
        mc:Ignorable="d"
        Title="FilePreview" Height="450" Width="800"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        AllowsTransparency="False"
        Background="Transparent"
        ExtendsContentIntoTitleBar="True"
        WindowBackdropType="Mica"
        ShowInTaskbar="True"
        Topmost="True"
        PreviewKeyDown="MainWindow_PreviewKeyDown"
        Deactivated="MainWindow_Deactivated">
    <Grid>
        <Border x:Name="RootBorder" 
                CornerRadius="12" 
                Background="{DynamicResource ApplicationBackgroundBrush}"
                BorderBrush="{DynamicResource WindowBorderActiveBrush}"
                BorderThickness="1"
                ClipToBounds="True"
                MouseLeftButtonDown="RootBorder_MouseLeftButtonDown">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Dedicated Title Bar / Menu Area -->
                <Border Grid.Row="0" Background="{DynamicResource ApplicationBackgroundBrush}" BorderBrush="{DynamicResource WindowBorderActiveBrush}" BorderThickness="0,0,0,1" Height="45">
                    <Grid Margin="10,0">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <ui:SymbolIcon x:Name="FileIcon" Symbol="Document24" Margin="0,0,10,0"/>
                            
                            <!-- Menu System -->
                            <Menu Background="Transparent" VerticalAlignment="Center" Margin="5,0,0,0">
                                <MenuItem Header="File">
                                    <MenuItem Header="Open with Default" Click="OpenButton_Click" Icon="{ui:SymbolIcon Symbol=Open24}"/>
                                    <MenuItem Header="Copy File Path" Click="CopyPath_Click" Icon="{ui:SymbolIcon Symbol=Copy24}"/>
                                    <MenuItem x:Name="CopyContentMenuItem" Header="Copy Text Content" Click="CopyContent_Click" Icon="{ui:SymbolIcon Symbol=DocumentCopy24}"/>
                                    <Separator />
                                    <MenuItem Header="Close" Click="CloseButton_Click" Icon="{ui:SymbolIcon Symbol=Dismiss24}"/>
                                </MenuItem>
                                <MenuItem Header="View">
                                    <MenuItem Header="Minimize" Click="MinimizeButton_Click" Icon="{ui:SymbolIcon Symbol=Subtract24}"/>
                                    <MenuItem Header="Stay on Top" IsCheckable="True" IsChecked="True" Click="StayOnTop_Click" />
                                    <MenuItem Header="Show Details" IsCheckable="True" Click="ShowDetails_Click" />
                                </MenuItem>
                                <MenuItem Header="Tools">
                                    <MenuItem Header="Open Containing Folder" Click="OpenFolder_Click" Icon="{ui:SymbolIcon Symbol=FolderOpen24}"/>
                                    <MenuItem Header="Refresh Preview" Click="Refresh_Click" Icon="{ui:SymbolIcon Symbol=ArrowClockwise24}"/>
                                </MenuItem>
                                <MenuItem Header="Help">
                                    <MenuItem Header="About" Click="About_Click" Icon="{ui:SymbolIcon Symbol=Info24}"/>
                                    <MenuItem Header="GitHub Repository" Click="GitHub_Click" Icon="{ui:SymbolIcon Symbol=Link24}"/>
                                </MenuItem>
                            </Menu>
                            
                            <TextBlock x:Name="TitleTextBlock" VerticalAlignment="Center" FontSize="13" FontWeight="SemiBold" Margin="15,0" MaxWidth="300" TextTrimming="CharacterEllipsis"/>
                        </StackPanel>
                        
                        <!-- Right Side Controls -->
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                            <ui:Button x:Name="MinimizeButton" Icon="{ui:SymbolIcon Symbol=Subtract24}" Appearance="Transparent" Click="MinimizeButton_Click" Height="32" Width="32" Margin="0,0,5,0"/>
                            <ui:Button x:Name="CloseButtonTop" Icon="{ui:SymbolIcon Dismiss24}" Appearance="Transparent" Click="CloseButton_Click" Height="32" Width="32"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Content Area -->
                <ContentControl x:Name="PreviewContent" Grid.Row="1" />
                
                <!-- Overlay Info Badge (Bottom Right) -->
                <Border VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="15" Padding="8,4" CornerRadius="4" Background="#AA000000" x:Name="InfoBadge" IsHitTestVisible="False">
                    <TextBlock x:Name="FormatInfoText" Foreground="White" FontSize="11" />
                </Border>
            </Grid>
        </Border>
    </Grid>
</ui:FluentWindow>